@extends('layouts.master')
@section('title', '| Vulnerability Map')
@section('content')

    <!--- COMMENTS: DROPDOWN OF THE BRGYS (ADMIN) -->

    @if (Auth::user()->user_role == 1 || Auth::user()->user_role >= 3)
        <script type="text/javascript">
            function initMap() {

                var userBrgy = @json($barangays);
                var userLat = userBrgy[0]['brgy_lat'];
                var userLng = userBrgy[0]['brgy_lng'];

                //parsed

                var userLatparse = parseFloat(userLat);
                var userLngparse = parseFloat(userLng);
                @if (Auth::user()->user_role == 1)
                    var options = {
                    zoom: 12,
                    center: {
                    lat: 14.5764,
                    lng: 121.0851
                    },
                    }
                
                    var options2 = {
                    zoom: 13,
                    center: {
                    lat: 14.5764,
                    lng: 121.0851
                    },
                    }
                
                @elseif (Auth::user()->user_role >= 3)
                    var options = {
                    zoom: 16,
                    center: {
                    lat: userLatparse,
                    lng: userLngparse
                    },
                    }
                
                    var options2 = {
                    zoom: 16,
                    center: {
                    lat: userLatparse,
                    lng: userLngparse
                    },
                    }
                @endif


                var map = new google.maps.Map(document.getElementById('map'), options);
                var vmap = new google.maps.Map(document.getElementById('vmap_all'), options);

                //values from database
                var storedLocations = [
                    @foreach ($vulnerableareas as $vulnerablearea)
                        ["{{ $vulnerablearea->vulArea_lat }}",
                        "{{ $vulnerablearea->vulArea_lng }}",
                        "{{ $vulnerablearea->degree }}",
                        "{{ $vulnerablearea->id }}",
                        "{{ $vulnerablearea->type_of_disaster }}",
                        "{{ date('F d, Y \a\t h:i A', strtotime($vulnerablearea->created_at)) }}",
                        "{{ $vulnerablearea->brgy_loc }}",
                        "{{ $vulnerablearea->nearest_landmark }}",
                        "{{ $vulnerablearea->is_approved }}",
                        ],
                    @endforeach
                ];

                // 0: lat, 1: lng, 2: degree, 3: id, 4: type, 5: createdat, 6: brgy, 7: landmark, 8: approved

                //function newLocation(newLat, newLng) {
                //    map.setCenter({
                //        lat: newLat,
                //        lng: newLng
                //    });
                //}
                //Setting Location with jQuery
                //$(document).ready(function() {
                //    $("#brgyDelaPaz").on('click', function() {
                //        newLocation(14.6137, 121.0960);
                //    });

                //    $("#brgyManggahan").on('click', function() {
                //        newLocation(14.601887, 121.093698);
                //    });

                //    $("#brgyMaybunga").on('click', function() {
                //        newLocation(14.5763, 121.0850);
                //    });

                //    $("#brgySantolan").on('click', function() {
                //        newLocation(14.6131, 121.0880);
                //    });

                //    $("#brgyRosario").on('click', function() {
                //        newLocation(14.5885, 121.0891);
                //    });
                //});

                function newLocation(newLat, newLng) {
                    vmap.setCenter({
                        lat: newLat,
                        lng: newLng
                    });
                    vmap.setZoom(16);
                }

                $(document).ready(function() {
                    $("#1").on('click', function() {
                        document.getElementById('barangay-name').innerHTML = "Barangay Bagong Ilog";
                        newLocation(14.5654, 121.0693);
                    });

                    $("#2").on('click', function() {
                        document.getElementById('barangay-name').innerHTML = "Barangay Bagong Katipunan";
                        newLocation(14.5591, 121.0747);
                    });

                    $("#3").on('click', function() {
                        document.getElementById('barangay-name').innerHTML = "Barangay Bambang";
                        newLocation(14.5554, 121.0801);
                    });

                    $("#4").on('click', function() {
                        document.getElementById('barangay-name').innerHTML = "Barangay Buting";
                        newLocation(14.5547, 121.0672);
                    });

                    $("#5").on('click', function() {
                        document.getElementById('barangay-name').innerHTML = "Barangay Caniogan";
                        newLocation(14.5719, 121.0779);
                    });
                    $("#6").on('click', function() {
                        document.getElementById('barangay-name').innerHTML = "Barangay Kalawaan";
                        newLocation(14.5488, 121.0866);
                    });
                    $("#7").on('click', function() {
                        document.getElementById('barangay-name').innerHTML = "Barangay Kapasigan";
                        newLocation(14.5638, 121.0758);
                    });
                    $("#8").on('click', function() {
                        document.getElementById('barangay-name').innerHTML = "Barangay Kapitolyo";
                        newLocation(14.5692, 121.0602);
                    });
                    $("#9").on('click', function() {
                        document.getElementById('barangay-name').innerHTML = "Barangay Malinao";
                        newLocation(14.5595, 121.0787);
                    });
                    $("#10").on('click', function() {
                        document.getElementById('barangay-name').innerHTML = "Barangay Oranbo";
                        newLocation(14.5758, 121.0643);
                    });
                    $("#11").on('click', function() { //parang wala sa maps
                        document.getElementById('barangay-name').innerHTML = "Barangay Palatiw";
                        newLocation(14.5636, 121.0858);
                    });
                    $("#12").on('click', function() {
                        document.getElementById('barangay-name').innerHTML = "Barangay Pineda";
                        newLocation(14.5636, 121.0636);
                    });
                    $("#13").on('click', function() {
                        document.getElementById('barangay-name').innerHTML = "Barangay Sagad";
                        newLocation(14.5656, 121.0790);
                    });
                    $("#14").on('click', function() {
                        document.getElementById('barangay-name').innerHTML = "Barangay San Antonio";
                        newLocation(14.5827, 121.0615);
                    });
                    $("#15").on('click', function() {
                        document.getElementById('barangay-name').innerHTML = "Barangay San Joaquin";
                        newLocation(14.5522, 121.0758);
                    });
                    $("#16").on('click', function() {
                        document.getElementById('barangay-name').innerHTML = "Barangay San Jose";
                        newLocation(14.5605, 121.0740);
                    });
                    $("#17").on('click', function() {
                        document.getElementById('barangay-name').innerHTML = "Barangay San Nicolas";
                        newLocation(14.5609, 121.0804);
                    });
                    $("#18").on('click', function() {
                        document.getElementById('barangay-name').innerHTML = "Barangay Sta. Cruz";
                        newLocation(14.5629, 121.0797);
                    });
                    $("#19").on('click', function() {
                        document.getElementById('barangay-name').innerHTML = "Barangay Sta. Rosa";
                        newLocation(14.5577, 121.0711);
                    });
                    $("#20").on('click', function() {
                        document.getElementById('barangay-name').innerHTML = "Barangay Sto. Tomas";
                        newLocation(14.5615, 121.0830);
                    });
                    $("#21").on('click', function() {
                        document.getElementById('barangay-name').innerHTML = "Barangay Sumilang";
                        newLocation(14.5563, 121.0744);
                    });
                    $("#22").on('click', function() {
                        document.getElementById('barangay-name').innerHTML = "Barangay Ugong";
                        newLocation(14.5829, 121.0726);
                    });
                    $("#23").on('click', function() {
                        document.getElementById('barangay-name').innerHTML = "Barangay Dela Paz";
                        newLocation(14.6137, 121.0960);
                    });
                    $("#24").on('click', function() {
                        document.getElementById('barangay-name').innerHTML = "Barangay Manggahan";
                        newLocation(14.60188, 121.093698);
                    });
                    $("#25").on('click', function() {
                        document.getElementById('barangay-name').innerHTML = "Barangay Maybunga";
                        newLocation(14.5763, 121.0850);
                    });
                    $("#26").on('click', function() {
                        document.getElementById('barangay-name').innerHTML = "Barangay Pinagbuhatan";
                        newLocation(14.5497, 121.0977);
                    });
                    $("#27").on('click', function() {
                        document.getElementById('barangay-name').innerHTML = "Barangay Rosario";
                        newLocation(14.5885, 121.0891);
                    });
                    $("#28").on('click', function() {
                        document.getElementById('barangay-name').innerHTML = "Barangay San Miguel";
                        newLocation(14.5672, 121.0923);
                    });
                    $("#29").on('click', function() {
                        document.getElementById('barangay-name').innerHTML = "Barangay Santolan";
                        newLocation(14.6131, 121.0880);
                    });
                    $("#30").on('click', function() {
                        document.getElementById('barangay-name').innerHTML = "Barangay Sta. Lucia";
                        newLocation(14.5840, 121.1012);
                    });
                });



                var infoWindow = new google.maps.InfoWindow();


                //loop coordinates from database
                for (var i = 0; i < storedLocations.length; i++) {
                    var data = storedLocations[i]
                    var location = new google.maps.LatLng(data[0], data[1]);
                    let id = data[3];

                    $('#id').val(id);
                    // 0: lat, 1: lng, 2: degree, 3: id, 4: type, 5: createdat, 6: brgy, 7: landmark, 8: approved

                    if (data[8] == '0') {
                        if (data[2] == 'High') {
                            var marker = new google.maps.Circle({
                                center: location,
                                map: map,
                                radius: 100,
                                strokeOpacity: 0.8,
                                strokeWeight: 2,
                                fillOpacity: 0.35,
                                position: location,
                                map: map,
                                fillColor: "#808080",
                                strokeColor: "#808080",
                                html: '<div class="card">' + '<div class="card-body">' +
                                    '<h5><span class="badge badge-danger">Not yet approved</span></h5> ' +
                                    '<h5 class="card-title"><strong>' + data[4] + '</strong></h5>' +
                                    ' <h6 class="card-subtitle mb-2 text-muted">' + data[6] + '</h6>' +
                                    ' <h6 class="card-subtitle mb-2 text-muted"><span class="badge badge-danger">High Vulnerability</span></h6>' +
                                    ' <h6 class="card-subtitle mb-2 text-muted"><span class="badge badge-primary">' +
                                    data[
                                        5] + '</span></h6>' +
                                    '<p class="card-text">' +
                                    '<i class="fas fa-directions mr-2 color"></i>Nearest Landmark: ' + data[7] +
                                    '</p>' +
                                    '</div>' +
                                    '</div>',
                            });
                        } else {
                            var marker = new google.maps.Circle({
                                center: location,
                                map: map,
                                radius: 100,
                                strokeOpacity: 0.8,
                                strokeWeight: 2,
                                fillOpacity: 0.35,
                                position: location,
                                map: map,
                                fillColor: "#808080",
                                strokeColor: "#808080",
                                html: '<div class="card">' + '<div class="card-body">' +
                                    '<h5><span class="badge badge-danger">Not yet approved</span></h5> ' +
                                    '<h5 class="card-title"><strong>' + data[4] + '</strong></h5>' +
                                    ' <h6 class="card-subtitle mb-2 text-muted">' + data[6] + '</h6>' +
                                    ' <h6 class="card-subtitle mb-2 text-muted"><span class="badge badge-warning">Medium Vulnerability</span></h6>' +
                                    ' <h6 class="card-subtitle mb-2 text-muted"><span class="badge badge-primary">' +
                                    data[
                                        5] + '</span></h6>' +
                                    '<p class="card-text">' +
                                    '<i class="fas fa-directions mr-2 color"></i>Nearest Landmark: ' + data[7] +
                                    '</p>' +
                                    '</div>' +
                                    '</div>',
                            });
                        }

                    } else {
                        if (data[2] == 'High') {
                            var marker = new google.maps.Circle({
                                center: location,
                                map: map,
                                radius: 100,
                                strokeOpacity: 0.8,
                                strokeWeight: 2,
                                fillOpacity: 0.35,
                                position: location,
                                map: map,
                                html: '<div class="card">' + '<div class="card-body">' +
                                    '<h5 class="card-title"><strong>' + data[4] + '</strong></h5>' +
                                    ' <h6 class="card-subtitle mb-2 text-muted">' + data[6] + '</h6>' +
                                    ' <h6 class="card-subtitle mb-2 text-muted"><span class="badge badge-danger">High Vulnerability</span></h6>' +
                                    ' <h6 class="card-subtitle mb-2 text-muted"><span class="badge badge-primary">' +
                                    data[5] + '</span></h6>' +
                                    '<p class="card-text">' +
                                    '<i class="fas fa-directions mr-2 color"></i>Nearest Landmark: ' + data[7] +
                                    '</p>' +
                                    '</div>' +
                                    '</div>',
                            });

                            marker.setOptions({
                                fillColor: "#FF0000",
                                strokeColor: "#FF0000",
                            });
                        } else {
                            var marker = new google.maps.Circle({
                                center: location,
                                map: map,
                                radius: 100,
                                strokeOpacity: 0.8,
                                strokeWeight: 2,
                                fillOpacity: 0.35,
                                position: location,
                                map: map,
                                html: '<div class="card">' + '<div class="card-body">' +
                                    '<h5 class="card-title"><strong>' + data[4] + '</strong></h5>' +
                                    ' <h6 class="card-subtitle mb-2 text-muted">' + data[6] + '</h6>' +
                                    ' <h6 class="card-subtitle mb-2 text-muted"><span class="badge badge-warning">Medium Vulnerability</span></h6>' +
                                    ' <h6 class="card-subtitle mb-2 text-muted"><span class="badge badge-primary">' +
                                    data[5] + '</span></h6>' +
                                    '<p class="card-text">' +
                                    '<i class="fas fa-directions mr-2 color"></i>Nearest Landmark: ' + data[7] +
                                    '</p>' +
                                    '</div>' +
                                    '</div>',
                            });
                            marker.setOptions({
                                fillColor: "#FFA500",
                                strokeColor: "#FFA500",
                            });
                        }

                    }

                    (function(marker, data) {
                        google.maps.event.addListener(marker, "click", function(e) {
                            infoWindow.setContent(marker.html);
                            infoWindow.open(map, marker);
                        });
                    })(marker, data);

                }


                //ALL VULNERABLE AREA

                var allMarkers = [
                    @foreach ($allvulnerableareas as $allvulnerablearea)
                        ["{{ $allvulnerablearea->vulArea_lat }}",
                        "{{ $allvulnerablearea->vulArea_lng }}",
                        "{{ $allvulnerablearea->degree }}",
                        "{{ $allvulnerablearea->id }}",
                        "{{ $allvulnerablearea->type_of_disaster }}",
                        "{{ date('F d, Y \a\t h:i A', strtotime($allvulnerablearea->created_at)) }}",
                        "{{ $allvulnerablearea->brgy_loc }}",
                        "{{ $allvulnerablearea->nearest_landmark }}",
                        "{{ $allvulnerablearea->is_approved }}",
                        ],
                    @endforeach
                ];

                //loop coordinates from database
                for (var i = 0; i < allMarkers.length; i++) {
                    var data = allMarkers[i]
                    var location = new google.maps.LatLng(data[0], data[1]);
                    let id = data[3];

                    $('#id').val(id);
                    // 0: lat, 1: lng, 2: degree, 3: id, 4: type, 5: createdat, 6: brgy, 7: landmark, 8: approved

                    if (data[8] == '0') {
                        if (data[2] == 'High') {
                            var marker = new google.maps.Circle({
                                center: location,
                                map: vmap,
                                radius: 100,
                                strokeOpacity: 0.8,
                                strokeWeight: 2,
                                fillOpacity: 0.35,
                                position: location,
                                map: vmap,
                                fillColor: "#808080",
                                strokeColor: "#808080",
                                html: '<div class="card">' + '<div class="card-body">' +
                                    '<h5><span class="badge badge-danger">Not yet approved</span></h5> ' +
                                    '<h5 class="card-title"><strong>' + data[4] + '</strong></h5>' +
                                    ' <h6 class="card-subtitle mb-2 text-muted">' + data[6] + '</h6>' +
                                    ' <h6 class="card-subtitle mb-2 text-muted"><span class="badge badge-danger">High Vulnerability</span></h6>' +
                                    ' <h6 class="card-subtitle mb-2 text-muted"><span class="badge badge-primary">' +
                                    data[
                                        5] + '</span></h6>' +
                                    '<p class="card-text">' +
                                    '<i class="fas fa-directions mr-2 color"></i>Nearest Landmark: ' + data[7] +
                                    '</p>' +
                                    '</div>' +
                                    '</div>',
                            });
                        } else {
                            var marker = new google.maps.Circle({
                                center: location,
                                map: vmap,
                                radius: 100,
                                strokeOpacity: 0.8,
                                strokeWeight: 2,
                                fillOpacity: 0.35,
                                position: location,
                                map: vmap,
                                fillColor: "#808080",
                                strokeColor: "#808080",
                                html: '<div class="card">' + '<div class="card-body">' +
                                    '<h5><span class="badge badge-danger">Not yet approved</span></h5> ' +
                                    '<h5 class="card-title"><strong>' + data[4] + '</strong></h5>' +
                                    ' <h6 class="card-subtitle mb-2 text-muted">' + data[6] + '</h6>' +
                                    ' <h6 class="card-subtitle mb-2 text-muted"><span class="badge badge-warning">Medium Vulnerability</span></h6>' +
                                    ' <h6 class="card-subtitle mb-2 text-muted"><span class="badge badge-primary">' +
                                    data[
                                        5] + '</span></h6>' +
                                    '<p class="card-text">' +
                                    '<i class="fas fa-directions mr-2 color"></i>Nearest Landmark: ' + data[7] +
                                    '</p>' +
                                    '</div>' +
                                    '</div>',
                            });
                        }

                    } else {
                        if (data[2] == 'High') {
                            var marker = new google.maps.Circle({
                                center: location,
                                map: vmap,
                                radius: 100,
                                strokeOpacity: 0.8,
                                strokeWeight: 2,
                                fillOpacity: 0.35,
                                position: location,
                                map: vmap,
                                html: '<div class="card">' + '<div class="card-body">' +
                                    '<h5 class="card-title"><strong>' + data[4] + '</strong></h5>' +
                                    ' <h6 class="card-subtitle mb-2 text-muted">' + data[6] + '</h6>' +
                                    ' <h6 class="card-subtitle mb-2 text-muted"><span class="badge badge-danger">High Vulnerability</span></h6>' +
                                    ' <h6 class="card-subtitle mb-2 text-muted"><span class="badge badge-primary">' +
                                    data[5] + '</span></h6>' +
                                    '<p class="card-text">' +
                                    '<i class="fas fa-directions mr-2 color"></i>Nearest Landmark: ' + data[7] +
                                    '</p>' +
                                    '</div>' +
                                    '</div>',
                            });

                            marker.setOptions({
                                fillColor: "#FF0000",
                                strokeColor: "#FF0000",
                            });
                        } else {
                            var marker = new google.maps.Circle({
                                center: location,
                                map: vmap,
                                radius: 100,
                                strokeOpacity: 0.8,
                                strokeWeight: 2,
                                fillOpacity: 0.35,
                                position: location,
                                map: vmap,
                                html: '<div class="card">' + '<div class="card-body">' +
                                    '<h5 class="card-title"><strong>' + data[4] + '</strong></h5>' +
                                    ' <h6 class="card-subtitle mb-2 text-muted">' + data[6] + '</h6>' +
                                    ' <h6 class="card-subtitle mb-2 text-muted"><span class="badge badge-warning">Medium Vulnerability</span></h6>' +
                                    ' <h6 class="card-subtitle mb-2 text-muted"><span class="badge badge-primary">' +
                                    data[5] + '</span></h6>' +
                                    '<p class="card-text">' +
                                    '<i class="fas fa-directions mr-2 color"></i>Nearest Landmark: ' + data[7] +
                                    '</p>' +
                                    '</div>' +
                                    '</div>',
                            });
                            marker.setOptions({
                                fillColor: "#FFA500",
                                strokeColor: "#FFA500",
                            });
                        }

                    }

                    (function(marker, data) {
                        google.maps.event.addListener(marker, "click", function(e) {
                            infoWindow.setContent(marker.html);
                            infoWindow.open(vmap, marker);
                        });
                    })(marker, data);

                }
            }
        </script>

    @elseif(Auth::user()->user_role == 2)

        <script>
            //resident side

            function initMap() {
                var userBrgy = @json($barangays);
                var userLat = userBrgy[0]['brgy_lat'];
                var userLng = userBrgy[0]['brgy_lng'];

                //parsed

                var userLatparse = parseFloat(userLat);
                var userLngparse = parseFloat(userLng);

                var options = {
                    zoom: 16,
                    center: {
                        lat: userLatparse,
                        lng: userLngparse
                    },
                }
                var resmap = new google.maps.Map(document.getElementById('resmap'), options);
                var approved = [
                    @foreach ($approvedareas as $approvedarea)
                        ["{{ $approvedarea->vulArea_lat }}",
                        "{{ $approvedarea->vulArea_lng }}",
                        "{{ $approvedarea->degree }}",
                        "{{ $approvedarea->id }}",
                        "{{ $approvedarea->type_of_disaster }}",
                        "{{ date('F d, Y \a\t h:i A', strtotime($approvedarea->created_at)) }}",
                        "{{ $approvedarea->brgy_loc }}",
                        "{{ $approvedarea->nearest_landmark }}",
                        "{{ $approvedarea->is_approved }}",
                        ],
                    @endforeach
                ];

                var infoWindow = new google.maps.InfoWindow();

                //loop coordinates from database
                for (var i = 0; i < approved.length; i++) {
                    var data = approved[i]
                    var location = new google.maps.LatLng(data[0], data[1]);
                    let id = data[3];

                    $('#id').val(id);
                    // 0: lat, 1: lng, 2: degree, 3: id, 4: type, 5: createdat, 6: brgy, 7: landmark, 8: approved


                    if (data[2] == 'High') {
                        var marker = new google.maps.Circle({
                            center: location,
                            map: resmap,
                            radius: 100,
                            strokeOpacity: 0.8,
                            strokeWeight: 2,
                            fillOpacity: 0.35,
                            position: location,
                            map: resmap,
                            html: '<div class="card">' + '<div class="card-body">' +
                                '<h5 class="card-title"><strong>' + data[4] + '</strong></h5>' +
                                ' <h6 class="card-subtitle mb-2 text-muted">' + data[6] + '</h6>' +
                                ' <h6 class="card-subtitle mb-2 text-muted"><span class="badge badge-danger">High Vulnerability</span></h6>' +
                                ' <h6 class="card-subtitle mb-2 text-muted"><span class="badge badge-primary">' +
                                data[5] + '</span></h6>' +
                                '<p class="card-text">' +
                                '<i class="fas fa-directions mr-2 color"></i>Nearest Landmark: ' + data[7] +
                                '</p>' +
                                '</div>' +
                                '</div>',
                        });

                        marker.setOptions({
                            fillColor: "#FF0000",
                            strokeColor: "#FF0000",
                        });
                    } else {
                        var marker = new google.maps.Circle({
                            center: location,
                            map: resmap,
                            radius: 100,
                            strokeOpacity: 0.8,
                            strokeWeight: 2,
                            fillOpacity: 0.35,
                            position: location,
                            map: resmap,
                            html: '<div class="card">' + '<div class="card-body">' +
                                '<h5 class="card-title"><strong>' + data[4] + '</strong></h5>' +
                                ' <h6 class="card-subtitle mb-2 text-muted">' + data[6] + '</h6>' +
                                ' <h6 class="card-subtitle mb-2 text-muted"><span class="badge badge-warning">Medium Vulnerability</span></h6>' +
                                ' <h6 class="card-subtitle mb-2 text-muted"><span class="badge badge-primary">' +
                                data[5] + '</span></h6>' +
                                '<p class="card-text">' +
                                '<i class="fas fa-directions mr-2 color"></i>Nearest Landmark: ' + data[7] +
                                '</p>' +
                                '</div>' +
                                '</div>',
                        });
                        marker.setOptions({
                            fillColor: "#FFA500",
                            strokeColor: "#FFA500",
                        });
                    }

                    (function(marker, data) {
                        google.maps.event.addListener(marker, "click", function(e) {
                            infoWindow.setContent(marker.html);
                            infoWindow.open(resmap, marker);
                        });
                    })(marker, data);

                }
            }
        </script>

    @endif


    <div class="container-fluid mb-5" style="color: black;">

        <div class="d-sm-flex align-items-center justify-content-between mb-4">
            <h1 class="h3 mb-0 text-gray-800">Vulnerability Map</h1>

            @if (Auth::user()->user_role >= 3)
                <a href="{{ route('user.vulnerabilitymap.create') }}"
                    class="d-sm-inline-block btn btn-primary shadow-sm"><i class="fas fa-pen fa-sm text-white-50"></i>
                    Update Vulnerability Map</a>
            @elseif (Auth::user()->user_role === 1)
                <a href="{{ route('admin.vulnerabilitymap.create') }}"
                    class="d-sm-inline-block btn btn-primary shadow-sm"><i class="fas fa-pen fa-sm text-white-50"></i>
                    Update Vulnerability Map</a>
            @endif
        </div>

        @if (Session::get('success'))
            <div class="alert alert-success mt-3 mb-3">
                {{ Session::get('success') }}
            </div>
        @endif

        <div class="card shadow">
            <div class="card-body">
                @if (Auth::user()->user_role == 1 || Auth::user()->user_role >= 3)
                    <ul class="nav nav-pills mb-3 justify-content-end" id="pills-tab" role="tablist">
                        <li class="nav-item">
                            <a class="nav-link active" id="pills-map-tab" data-toggle="pill" href="#pills-map" role="tab"
                                aria-controls="pills-map" aria-selected="true"><i class="fas fa-columns"
                                    onClick="window.location.reload();"></i></a>
                        </li>

                        @if (Auth::user()->user_role == 1 || Auth::user()->user_role >= 4)
                            <li class="nav-item">
                                <a class="nav-link" id="pills-table-tab" data-toggle="pill" href="#pills-table"
                                    role="tab" aria-controls="pills-table" aria-selected="false"><i
                                        class="fas fa-list"></i></a>
                            </li>
                        @endif

                        <li class="nav-item">
                            <a class="nav-link" id="pills-allMap-tab" data-toggle="pill" href="#pills-allMap"
                                role="tab" aria-controls="pills-allMap" aria-selected="false"><i
                                    class="fas fa-map-marked-alt"></i></a>
                        </li>

                    </ul>


                    <!-- MAP AND DETAILS -->
                    <div class="tab-content" id="pills-tabContent">
                        <div class="tab-pane fade show active" id="pills-map" role="tabpanel"
                            aria-labelledby="pills-map-tab">
                            @if (count($vulnerableareas) > 0)
                                <div class="row mt-3">
                                    <div class="col-sm-12 col-md-6 col-lg-4">
                                        @foreach ($vulnerableareas as $vulnerablearea)
                                            <div class="card mb-2">
                                                <div class="card-body">
                                                    @if ($vulnerablearea->is_approved === 0)
                                                        <h5><span class="badge badge-danger">Not yet Approved</span></h5>
                                                    @endif

                                                    <h5 class="card-title">
                                                        <strong>{{ $vulnerablearea->type_of_disaster }}</strong>
                                                    </h5>
                                                    <h6 class="card-subtitle mb-2 text-muted">
                                                        {{ $vulnerablearea->brgy_loc }}
                                                    </h6>
                                                    <div class="card-subtitle mb-2">
                                                        @if ($vulnerablearea->degree == 'High')
                                                            <span class="badge badge-danger">High Vulnerability</span>
                                                        @else
                                                            <span class="badge badge-warning">Medium Vulnerability</span>
                                                        @endif
                                                    </div>
                                                    <h6 class="card-subtitle mb-2">
                                                        <span class="badge badge-primary">
                                                            {{ date('F d, Y \a\t h:i A', strtotime($vulnerablearea->created_at)) }}</span>
                                                    </h6>
                                                    <p class="card-text">
                                                        <i class="fas fa-directions mr-2 color"></i>Nearest Landmark:
                                                        {{ $vulnerablearea->nearest_landmark }}

                                                    </p>
                                                </div>
                                            </div>
                                        @endforeach

                                        <div class="d-grid gap-2 mt-3 d-md-flex justify-content-center align-items-center">
                                            {{ $vulnerableareas->links() }}
                                        </div>



                                    </div>
                                    <div class="col-sm-12 col-md-6 col-lg-8">
                                        <div id="map" style="height:500px; width: 100%;"></div>

                                        <h6 class="mt-3 font-weight-bold">Legend:</h6>
                                        <ul class="list-inline">
                                            <li class="list-inline-item"><i class="fas fa-circle mr-2"
                                                    style="color:#FF0000"></i>High Vulnerability Area</li>
                                            <li class="list-inline-item"><i class="fas fa-circle mr-2"
                                                    style="color:#FFA500"></i>Medium Vulnerability Area</li>
                                            <li class="list-inline-item"><i class="fas fa-circle mr-2"
                                                    style="color:#808080"></i>Not
                                                yet approved</li>
                                        </ul>
                                    </div>

                                </div>

                            @else
                                <div class="card">
                                    <div class="card-body">
                                        There are no vulnerable areas added yet.
                                    </div>
                                </div>
                            @endif
                        </div>

                        <!-- TABLE -->
                        <div class="tab-pane fade" id="pills-table" role="tabpanel" aria-labelledby="pills-table-tab">
                            <div class="table-responsive">
                                <table class="table table-bordered data-table" id="dataTable" width="100%" cellspacing="0"
                                    style="color:#464646 !important">
                                    <thead>
                                        <tr>
                                            <th>No</th>
                                            <th>Issued By</th>
                                            <th>Issued On</th>
                                            <th>Nearest Landmark</th>
                                            <th>Type of Disaster</th>
                                            <th>Barangay Location</th>
                                            <th>Degree</th>
                                            <th>Approved</th>
                                            <th>Action</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                    </tbody>
                                </table>
                            </div>
                        </div>

                        <!-- ALL EVAC MAPS -->
                        <div class="tab-pane fade" id="pills-allMap" role="tabpanel" aria-labelledby="pills-allMap-tab">

                            @if (count($allvulnerableareas) > 0)

                                @if (Auth::user()->user_role == 1)
                                    <div class="d-sm-flex align-items-center justify-content-between">
                                        <h3 class="h3 text-gray-800" id="barangay-name"></h3>
                                        <div class="dropdown">
                                            <button class="btn btn-primary" type="button" id="dropdownMenu2"
                                                data-toggle="dropdown" aria-expanded="false">
                                                <i class="fas fa-caret-down"></i>
                                            </button>
                                            <div class="dropdown-menu" aria-labelledby="dropdownMenu2">


                                                @foreach ($barangays as $barangay)
                                                    <button class="dropdown-item" id="{{ $barangay->id }}"
                                                        type="button">{{ $barangay->brgy_loc }}</button>
                                                @endforeach

                                            </div>
                                        </div>
                                    </div>
                                @endif

                                <div id="vmap_all" class="map-container mt-3" style="height: 500px; width:100%;"></div>
                                <h6 class="mt-3 font-weight-bold">Legend:</h6>
                                <ul class="list-inline">
                                    <li class="list-inline-item"><i class="fas fa-circle mr-2"
                                            style="color:#FF0000"></i>High Vulnerability Area</li>
                                    <li class="list-inline-item"><i class="fas fa-circle mr-2"
                                            style="color:#FFA500"></i>Medium Vulnerability Area</li>
                                    <li class="list-inline-item"><i class="fas fa-circle mr-2" style="color:#808080"></i>Not
                                        yet approved</li>
                                </ul>


                            @else

                                <div class="card">
                                    <div class="card-body">
                                        There are no vulnerable areas added yet.
                                    </div>
                                </div>

                            @endif

                        </div>

                    </div>

                    <!-- RESIDENT SIDE -->
                @elseif (Auth::user()->user_role == 2)
                    @if (count($approvedareas) > 0)
                        <div class="row mt-3">
                            <div class="col-sm-12 col-md-6 col-lg-4">
                                @foreach ($approvedareas as $approvedarea)
                                    <div class="card mb-2">
                                        <div class="card-body">
                                            <h5 class="card-title">
                                                <strong>{{ $approvedarea->type_of_disaster }}</strong>
                                            </h5>
                                            <h6 class="card-subtitle mb-2 text-muted">
                                                {{ $approvedarea->brgy_loc }}
                                            </h6>
                                            <div class="card-subtitle mb-2">
                                                @if ($approvedarea->degree == 'High')
                                                    <span class="badge badge-danger">High Vulnerability</span>
                                                @else
                                                    <span class="badge badge-warning">Medium Vulnerability</span>
                                                @endif
                                            </div>
                                            <h6 class="card-subtitle mb-2">
                                                <span class="badge badge-primary">
                                                    {{ date('F d, Y \a\t h:i A', strtotime($approvedarea->created_at)) }}</span>
                                            </h6>
                                            <p class="card-text">
                                                <i class="fas fa-directions mr-2 color"></i>Nearest Landmark:
                                                {{ $approvedarea->nearest_landmark }}

                                            </p>
                                        </div>
                                    </div>
                                @endforeach

                                <div class="d-grid gap-2 mt-3 d-md-flex justify-content-center align-items-center">
                                    {{ $approvedareas->links() }}
                                </div>



                            </div>
                            <div class="col-sm-12 col-md-6 col-lg-8">
                                <div id="resmap" style="height:500px; width: 100%;"></div>
                            </div>

                        </div>

                    @else
                        <div class="card">
                            <div class="card-body">
                                There are no vulnerable areas added yet.
                            </div>
                        </div>
                    @endif
                @endif



            </div>
        </div>
    </div>


    <script async defer
        src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBOhN8Ve4h6uAEKm4Kh_2eznLfx0GIbOTo&callback=initMap">
    </script>

    @if (Auth::user()->user_role == 1)


        <script type="text/javascript">
            $(document).ready(function() {
                var table = $('.data-table').DataTable({
                    processing: true,
                    serverSide: true,
                    ajax: "{{ route('admin.vulnerabilitymap.index') }}",
                    columns: [{
                            data: 'id',
                            name: 'id'
                        },
                        {
                            data: 'issued_by',
                            name: 'issued_by'
                        },
                        {
                            data: 'created_at',
                            name: 'created_at'
                        },
                        {
                            data: 'nearest_landmark',
                            name: 'nearest_landmark'
                        },
                        {
                            data: 'type_of_disaster',
                            name: 'type_of_disaster'
                        },
                        {
                            data: 'brgy_loc',
                            name: 'brgy_loc'
                        },
                        {
                            data: 'degree',
                            name: 'degree'
                        },
                        {
                            data: 'is_approved',
                            name: 'is_approved'
                        },
                        {
                            data: 'action',
                            name: 'action',
                            orderable: false,
                            searchable: false
                        },
                    ],

                });

                $(document).on('click', '#deleteVulnerabilityMapBtn', function() {
                    var vulnerablearea_id = $(this).data('id');
                    console.log(vulnerablearea_id);

                    var row = table.row($(this).closest('tr'));
                    var data_row = row.data();

                    swal({
                            title: "Are you sure?",
                            text: "You want to delete this vulnerable area?",
                            icon: "warning",
                            buttons: true,
                            dangerMode: true,
                        })
                        .then((willDelete) => {
                            if (willDelete) {

                                $.ajaxSetup({
                                    headers: {
                                        'X-CSRF-TOKEN': '{{ csrf_token() }}'
                                    }
                                });

                                $.ajax({
                                    url: "https://kabisigapp.com/admin/vulnerabilitymap/" +
                                        vulnerablearea_id,
                                    type: 'DELETE',
                                    dataType: 'JSON',
                                    data: {
                                        "id": vulnerablearea_id
                                    },

                                    success: function(response) {
                                        //row.remove().draw();
                                        table.ajax.reload();
                                        swal("Deleted!", response.message, "success");
                                    },

                                    error: function(response) {
                                        console.log(response);
                                    }
                                });
                            } else {
                                swal("No changes were made!");
                            }
                        });


                });

                $(document).on('click', '#approveVulnerabilityBtn', function() {
                    var vulnerablearea_id = $(this).data('id');
                    console.log(vulnerablearea_id);

                    var row = table.row($(this).closest('tr'));
                    var data_row = row.data();

                    swal({
                            title: "Are you sure?",
                            text: "You want to approve this vulnerable area?",
                            icon: "warning",
                            buttons: true,
                            dangerMode: true,
                        })
                        .then((willDelete) => {
                            if (willDelete) {

                                $.ajaxSetup({
                                    headers: {
                                        'X-CSRF-TOKEN': '{{ csrf_token() }}'
                                    }
                                });

                                $.ajax({
                                    url: "https://kabisigapp.com/admin/vulnerabilitymap/approve/" +
                                        vulnerablearea_id,
                                    type: 'POST',
                                    dataType: 'JSON',
                                    data: {
                                        "id": vulnerablearea_id
                                    },

                                    success: function(response) {
                                        //row.remove().draw();
                                        table.ajax.reload();
                                        swal("Approved!", response.message, "success");
                                    },

                                    error: function(response) {
                                        console.log(response);
                                    }
                                });
                            } else {
                                swal("No changes were made!");
                            }
                        });


                });



            });
        </script>

    @elseif (Auth::user()->user_role >= 4)
        <script type="text/javascript">
            $(document).ready(function() {
                var table = $('.data-table').DataTable({
                    processing: true,
                    serverSide: true,
                    ajax: "{{ route('user.vulnerabilitymap.index') }}",
                    columns: [{
                            data: 'id',
                            name: 'id'
                        },
                        {
                            data: 'issued_by',
                            name: 'issued_by'
                        },
                        {
                            data: 'created_at',
                            name: 'created_at'
                        },
                        {
                            data: 'nearest_landmark',
                            name: 'nearest_landmark'
                        },
                        {
                            data: 'type_of_disaster',
                            name: 'type_of_disaster'
                        },
                        {
                            data: 'brgy_loc',
                            name: 'brgy_loc'
                        },
                        {
                            data: 'degree',
                            name: 'degree'
                        },
                        {
                            data: 'is_approved',
                            name: 'is_approved'
                        },
                        {
                            data: 'action',
                            name: 'action',
                            orderable: false,
                            searchable: false
                        },
                    ],

                });

                $(document).on('click', '#deleteVulnerabilityMapBtn', function() {
                    var vulnerablearea_id = $(this).data('id');
                    console.log(vulnerablearea_id);

                    var row = table.row($(this).closest('tr'));
                    var data_row = row.data();

                    swal({
                            title: "Are you sure?",
                            text: "You want to delete this vulnerable area?",
                            icon: "warning",
                            buttons: true,
                            dangerMode: true,
                        })
                        .then((willDelete) => {
                            if (willDelete) {

                                $.ajaxSetup({
                                    headers: {
                                        'X-CSRF-TOKEN': '{{ csrf_token() }}'
                                    }
                                });

                                $.ajax({
                                    url: "https://kabisigapp.com/user/vulnerabilitymap/" +
                                        vulnerablearea_id,
                                    type: 'DELETE',
                                    dataType: 'JSON',
                                    data: {
                                        "id": vulnerablearea_id
                                    },

                                    success: function(response) {
                                        //row.remove().draw();
                                        table.ajax.reload();
                                        swal("Deleted!", response.message, "success");
                                    },

                                    error: function(response) {
                                        console.log(response);
                                    }
                                });
                            } else {
                                swal("No changes were made!");
                            }
                        });


                });

                $(document).on('click', '#approveVulnerabilityBtn', function() {
                    var vulnerablearea_id = $(this).data('id');
                    console.log(vulnerablearea_id);

                    var row = table.row($(this).closest('tr'));
                    var data_row = row.data();

                    swal({
                            title: "Are you sure?",
                            text: "You want to approve this vulnerable area?",
                            icon: "warning",
                            buttons: true,
                            dangerMode: true,
                        })
                        .then((willDelete) => {
                            if (willDelete) {

                                $.ajaxSetup({
                                    headers: {
                                        'X-CSRF-TOKEN': '{{ csrf_token() }}'
                                    }
                                });

                                $.ajax({
                                    url: "https://kabisigapp.com/user/vulnerabilitymap/approve/" +
                                        vulnerablearea_id,
                                    type: 'POST',
                                    dataType: 'JSON',
                                    data: {
                                        "id": vulnerablearea_id
                                    },

                                    success: function(response) {
                                        //row.remove().draw();
                                        table.ajax.reload();
                                        swal("Approved!", response.message, "success");
                                    },

                                    error: function(response) {
                                        console.log(response);
                                    }
                                });
                            } else {
                                swal("No changes were made!");
                            }
                        });


                });



            });
        </script>

    @endif

@endsection
