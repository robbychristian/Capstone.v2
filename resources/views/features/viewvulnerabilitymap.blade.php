@extends('dashboard.admin.home')
@section('title', '| Vulnerability Map')
@section('sub-content')


    @if (Auth::user()->brgy_loc == 'Barangay Dela Paz')
        <script type="text/javascript">
            function initMap() {
                var options = {
                    zoom: 16,
                    center: {
                        lat: 14.6137,
                        lng: 121.0960
                    },
                }

                var map = new google.maps.Map(document.getElementById('map'), options);

                //values from database
                var storedLocations = [
                    @foreach ($coordinates as $coordinate)
                        ["{{ $coordinate->vulArea_lat }}","{{ $coordinate->vulArea_lng }}", "{{ $coordinate->degree }}",
                        "{{ $coordinate->id }}"],
                    @endforeach
                ];
                var infoWindow = new google.maps.InfoWindow();

                //icons for degree
                var red_circle = new google.maps.Marker({
                    path: google.maps.SymbolPath.CIRCLE,
                    scale: 90,
                    fillColor: "#F00",
                    fillOpacity: 0.4,
                    strokeWeight: 0.4,
                });

                var orange_circle = new google.maps.Marker({
                    path: google.maps.SymbolPath.CIRCLE,
                    scale: 90,
                    fillColor: "#FFA500",
                    fillOpacity: 0.4,
                    strokeWeight: 0.4,
                });


                //loop coordinates from database
                for (var i = 0; i < storedLocations.length; i++) {
                    var data = storedLocations[i]
                    var location = new google.maps.LatLng(data[0], data[1]);
                    let id = data[3];

                    $('#id').val(id);
                    var marker = new google.maps.Marker({
                        position: location,
                        map: map,
                        icon: data[2] == "H" ? red_circle : orange_circle,
                        /*html: data[0] + '<br>' + data[1] + '<br>' + data[2] + '<br>' + data[3] + '<br>' +
                            '<form action="/vulnerabilityMap/' + data[3] + '" method="post">' +
                            '@csrf' +
                            '@method("DELETE")' +
                            '<input class="btn btn-danger mt-2 btn-sm" type="submit" value="Delete Marker" onclick="showSuccess()">' +
                            '</form>', */
                    });

                    /*(function(marker, data) {
                        google.maps.event.addListener(marker, "click", function(e) {
                            infoWindow.setContent(marker.html);
                            infoWindow.open(map, marker);
                        });
                    })(marker, data); */

                }

            }
        </script>
    @elseif(Auth::user()->brgy_loc == "Barangay Manggahan")
        <script type="text/javascript">
            function initMap() {
                var options = {
                    zoom: 16,
                    center: {
                        lat: 14.601887,
                        lng: 121.093698
                    },
                }

                var map = new google.maps.Map(document.getElementById('map'), options);

                //values from database
                var storedLocations = [
                    @foreach ($coordinates as $coordinate)
                        ["{{ $coordinate->vulArea_lat }}","{{ $coordinate->vulArea_lng }}", "{{ $coordinate->degree }}",
                        "{{ $coordinate->id }}"],
                    @endforeach
                ];
                var infoWindow = new google.maps.InfoWindow();

                //icons for degree
                var red_circle = new google.maps.Marker({
                    path: google.maps.SymbolPath.CIRCLE,
                    scale: 90,
                    fillColor: "#F00",
                    fillOpacity: 0.4,
                    strokeWeight: 0.4,
                });

                var orange_circle = new google.maps.Marker({
                    path: google.maps.SymbolPath.CIRCLE,
                    scale: 90,
                    fillColor: "#FFA500",
                    fillOpacity: 0.4,
                    strokeWeight: 0.4,
                });


                //loop coordinates from database
                for (var i = 0; i < storedLocations.length; i++) {
                    var data = storedLocations[i]
                    var location = new google.maps.LatLng(data[0], data[1]);
                    let id = data[3];

                    $('#id').val(id);
                    var marker = new google.maps.Marker({
                        position: location,
                        map: map,
                        icon: data[2] == "H" ? red_circle : orange_circle,
                        /*html: data[0] + '<br>' + data[1] + '<br>' + data[2] + '<br>' + data[3] + '<br>' +
                            '<form action="/vulnerabilityMap/' + data[3] + '" method="post">' +
                            '@csrf' +
                            '@method("DELETE")' +
                            '<input class="btn btn-danger mt-2 btn-sm" type="submit" value="Delete Marker" onclick="showSuccess()">' +
                            '</form>', */
                    });

                    /*(function(marker, data) {
                        google.maps.event.addListener(marker, "click", function(e) {
                            infoWindow.setContent(marker.html);
                            infoWindow.open(map, marker);
                        });
                    })(marker, data); */

                }

            }
        </script>
    @elseif(Auth::user()->brgy_loc == "Barangay Maybunga")
        <script type="text/javascript">
            function initMap() {
                var options = {
                    zoom: 16,
                    center: {
                        lat: 14.5763,
                        lng: 121.0850
                    },
                }

                var map = new google.maps.Map(document.getElementById('map'), options);

                //values from database
                var storedLocations = [
                    @foreach ($coordinates as $coordinate)
                        ["{{ $coordinate->vulArea_lat }}","{{ $coordinate->vulArea_lng }}", "{{ $coordinate->degree }}",
                        "{{ $coordinate->id }}"],
                    @endforeach
                ];
                var infoWindow = new google.maps.InfoWindow();

                //icons for degree
                var red_circle = new google.maps.Marker({
                    path: google.maps.SymbolPath.CIRCLE,
                    scale: 90,
                    fillColor: "#F00",
                    fillOpacity: 0.4,
                    strokeWeight: 0.4,
                });

                var orange_circle = new google.maps.Marker({
                    path: google.maps.SymbolPath.CIRCLE,
                    scale: 90,
                    fillColor: "#FFA500",
                    fillOpacity: 0.4,
                    strokeWeight: 0.4,
                });


                //loop coordinates from database
                for (var i = 0; i < storedLocations.length; i++) {
                    var data = storedLocations[i]
                    var location = new google.maps.LatLng(data[0], data[1]);
                    let id = data[3];

                    $('#id').val(id);
                    var marker = new google.maps.Marker({
                        position: location,
                        map: map,
                        icon: data[2] == "H" ? red_circle : orange_circle,
                        /*html: data[0] + '<br>' + data[1] + '<br>' + data[2] + '<br>' + data[3] + '<br>' +
                            '<form action="/vulnerabilityMap/' + data[3] + '" method="post">' +
                            '@csrf' +
                            '@method("DELETE")' +
                            '<input class="btn btn-danger mt-2 btn-sm" type="submit" value="Delete Marker" onclick="showSuccess()">' +
                            '</form>', */
                    });

                    /*(function(marker, data) {
                        google.maps.event.addListener(marker, "click", function(e) {
                            infoWindow.setContent(marker.html);
                            infoWindow.open(map, marker);
                        });
                    })(marker, data); */

                }

            }
        </script>
    @elseif(Auth::user()->brgy_loc == "Barangay Rosario")
        <script type="text/javascript">
            function initMap() {
                var options = {
                    zoom: 16,
                    center: {
                        lat: 14.5885,
                        lng: 121.0891
                    },
                }

                var map = new google.maps.Map(document.getElementById('map'), options);

                //values from database
                var storedLocations = [
                    @foreach ($coordinates as $coordinate)
                        ["{{ $coordinate->vulArea_lat }}","{{ $coordinate->vulArea_lng }}", "{{ $coordinate->degree }}",
                        "{{ $coordinate->id }}"],
                    @endforeach
                ];
                var infoWindow = new google.maps.InfoWindow();

                //icons for degree
                var red_circle = new google.maps.Marker({
                    path: google.maps.SymbolPath.CIRCLE,
                    scale: 90,
                    fillColor: "#F00",
                    fillOpacity: 0.4,
                    strokeWeight: 0.4,
                });

                var orange_circle = new google.maps.Marker({
                    path: google.maps.SymbolPath.CIRCLE,
                    scale: 90,
                    fillColor: "#FFA500",
                    fillOpacity: 0.4,
                    strokeWeight: 0.4,
                });


                //loop coordinates from database
                for (var i = 0; i < storedLocations.length; i++) {
                    var data = storedLocations[i]
                    var location = new google.maps.LatLng(data[0], data[1]);
                    let id = data[3];

                    $('#id').val(id);
                    var marker = new google.maps.Marker({
                        position: location,
                        map: map,
                        icon: data[2] == "H" ? red_circle : orange_circle,
                        /*html: data[0] + '<br>' + data[1] + '<br>' + data[2] + '<br>' + data[3] + '<br>' +
                            '<form action="/vulnerabilityMap/' + data[3] + '" method="post">' +
                            '@csrf' +
                            '@method("DELETE")' +
                            '<input class="btn btn-danger mt-2 btn-sm" type="submit" value="Delete Marker" onclick="showSuccess()">' +
                            '</form>', */
                    });

                    /*(function(marker, data) {
                        google.maps.event.addListener(marker, "click", function(e) {
                            infoWindow.setContent(marker.html);
                            infoWindow.open(map, marker);
                        });
                    })(marker, data); */

                }

            }
        </script>
    @elseif(Auth::user()->brgy_loc == "Barangay Santolan" || Auth::user()->user_role == 1)
        <script type="text/javascript">
            function initMap() {
                var options = {
                    zoom: 16,
                    center: {
                        lat: 14.6131,
                        lng: 121.0880
                    },
                }

                var map = new google.maps.Map(document.getElementById('map'), options);

                //values from database
                var storedLocations = [
                    @foreach ($coordinates as $coordinate)
                        ["{{ $coordinate->vulArea_lat }}","{{ $coordinate->vulArea_lng }}", "{{ $coordinate->degree }}",
                        "{{ $coordinate->id }}"],
                    @endforeach
                ];
                var infoWindow = new google.maps.InfoWindow();

                //icons for degree
                var red_circle = new google.maps.Circle({
                    strokeColor: "#FF0000",
                    strokeOpacity: 0.8,
                    strokeWeight: 2,
                    fill_Color: "#FF0000",
                    fill_Opacity: 0.35,
                });

                var orange_circle = new google.maps.Circle({
                    strokeColor: "#FF0000",
                    strokeOpacity: 0.8,
                    strokeWeight: 2,
                    fill_Color: "#FF0000",
                    fill_Opacity: 0.35,
                });


                //loop coordinates from database
                for (var i = 0; i < storedLocations.length; i++) {
                    var data = storedLocations[i]
                    var location = new google.maps.LatLng(data[0], data[1]);
                    let id = data[3];

                    $('#id').val(id);
                    var marker = new google.maps.Circle({
                        center: location,
                        map: map,
                        radius: 50,
                        icon: data[2] == "H" ? red_circle : orange_circle,
                        html: data[2]
                        /*'<form action="/vulnerabilityMap/' + data[3] + '" method="post">' +
                        '@csrf' +
                        '@method("DELETE")' +
                        '<input class="btn btn-danger mt-2 btn-sm" type="submit" value="Delete Marker" onclick="showSuccess()">' +
                        '</form>', */
                    });

                    (function(marker, data) {
                        google.maps.event.addListener(marker, "click", function(e) {
                            infoWindow.setContent(marker.html);
                            infoWindow.open(map, marker);
                        });
                    })(marker, data);

                }

            }
        </script>
    @endif

    <div class="col-xl-10 col-lg-9 col-md-8 mt-3">
        <div class="row">
            <div class="col-sm-12 col-md-8">
                <h3 class="mb-3">Vulnerability Map</h3>
            </div>
            @if (Auth::user()->user_role === 1 || Auth::user()->user_role === 3)
                <div class="col-sm-12 col-md-4">
                    <div class="d-grid gap-2 d-md-flex justify-content-md-end">
                        @if (Auth::user()->user_role === 3)
                            <a href="{{ route('brgy_official.vulnerabilitymap.create') }}" class="btn btn-primary">Update
                                Vulnerability
                                Map</a>
                        @elseif (Auth::user()->user_role === 1)
                            <a href="{{ route('admin.vulnerabilitymap.create') }}" class="btn btn-primary">Update
                                Vulnerability
                                Map</a>
                        @endif
                    </div>
                </div>
            @endif
        </div>

        <div>
            <div class="container px-lg-5">
                <h3 style="font-weight:700">Legends:</h3>
                <div class="row mx-lg-n5">
                    <div class="col py-3 px-lg-5"> <span class="fa fa-circle fa-4x icon-legend"
                            style=" vertical-align: middle; color: #FFA500"></span>
                        <span class="legend-text">Medium Vulnerability Area</span>
                    </div>
                    <div class="col py-3 px-lg-5"> <span class="fa fa-circle fa-4x icon-legend"
                            style=" vertical-align: middle; color: #F00"></span>
                        <span class="legend-text">High Vulnerability Area</span>
                    </div>
                </div>
            </div>


        </div>

        <div class="card shadow-card mb-3">
            <div class="card-body">
                <div id="map" style="height: 600px; width: 100%;"></div>
            </div>
        </div>

    </div>

    <script async defer
        src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBOhN8Ve4h6uAEKm4Kh_2eznLfx0GIbOTo&callback=initMap">
    </script>



@endsection
